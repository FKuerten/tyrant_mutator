# Configuration section
MODULE_NAME=
DEPENDENCIES=basics core
LIBS:=-lboost_program_options

include scripts/objectsMakeppfile.mk
include scripts/version.mk

$(phony FORCE):
    @true

global CXXFLAGS+= --std=c++11
global CPPFLAGS:=${CPPFLAGS} -I${CURDIR}/target/generated


CPPFLAGS+=-I${CURDIR}/../${DEPENDENCIES}/src/main/c++/
LIBS+=$(addprefix -l,${DEPENDENCIES})
LDFLAGS+=-L${CURDIR}/../${DEPENDENCIES}/target/
OWN_LIB_FILES=$(shell ./scripts/expandModules.sh ${DEPENDENCIES})
iftrue ${DEPENDENCIES}
	DEPENDENCY_FILES:=${CURDIR}/../${DEPENDENCIES}/target/dependencies
	DEPLIBS=$(shell cat ${DEPENDENCY_FILES})
else
	DEPENDENCY_FILES:=
	DEPLIBS:=
endif

load_makefile target/objects/Makeppfile
load_makefile ${CURDIR}/../${DEPENDENCIES}

OBJECTS:=$(shell ./scripts/findObjects.sh)
ALLLIBS=${LIBS} ${DEPLIBS}

target/tyrantMutator: $(infer_objects target/objects/cli/main.o++, ${OBJECTS}) ${OWN_LIB_FILES} ${DEPENDENCY_FILES}
	@if [ -e ${output} ]; then rm ${output}; echo "rm ${output}"; fi
	${CXX} ${LDFLAGS} \
	       $(infer_objects target/objects/cli/main.o++, ${OBJECTS}) \
	       ${ALLLIBS} \
	       -o ${output}

target/dependencies:
    echo ${ALLLIBS} > ${output}
